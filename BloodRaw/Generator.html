<!DOCTYPE HTML>
<meta charset="utf-8">
<title>BloodRaw</title>
<link rel="icon" type="image/x-icon" href="Source/iconblock.ico">

<meta property="og:type" content="website">
<meta property="og:url" content="https://woowz11.github.io/woowzsite/BloodRaw/Main">
<meta property="og:image" content="https://raw.githubusercontent.com/Woowz11/woowzsite/main/BloodRaw/Source/og.png">
<meta name="twitter:card" content="summary_large_image">

<meta property="og:site_name" content="Bloodraw">
<meta property="og:title" content="Minecraft Texture/Resource pack!">
<meta property="og:description" content="">

<link rel="stylesheet" href="Source/css.css">

<style>
html{
	background-image: url("Source/dirt.png");
	background-size: 64px 64px;
	image-rendering: pixelated;
}

.Container{
	max-width: 1000px;
	margin: 20px auto;
	padding: 20px;
	display: flex;
    flex-direction: column;
    gap: 15px;
}

h1{
	font-size: 2em;
	margin-bottom: 10px;
	color: #FFFF55;
	text-align: center;
}

.Console{
	background: black;
	color: #00FF00;
	font-family: monospace;
	font-size: 0.9em;
	padding: 10px;
	height: 200px;
	overflow-y: auto;
	outline: 3px solid rgba(0,0,0,0.5);
	text-shadow: none;
}

</style>

<link href="../Libs/select2.min.css" rel="stylesheet" />
<script src="../Libs/jquery.min.js"></script>
<script src="../Libs/select2.min.js"></script>

<body id="body"><div class="Container">
	<input type="file" id="PreLoadPack" accept=".zip" style="display: none;">

	<h1>Генератор ресурс-пака</h1>

	<div>
		<p>Текущая версия: <b>v1.3.5</b></p>
		<a href="#">Changelog</a>
	</div>

	<div>
		<p>Версия:</p>
		<select id="SelectVersion" style="width: 400px;"></select>
	</div>
	
	<hr>

	<div style="text-align:center;">
		<button id="B_Generate" onclick="Generate();">Сгенерировать пак</button>
	</div>

	<div>
		<p>Консоль:</p>
		<div class="Console" id="Console"></div>
	</div>

</div></body>

<script src="../source/Logger.js"></script>
<script src="../Libs/jszip.min.js"></script>
<script>

/* Запущен сайт локально? */ const IsLocal	= window.location.protocol === "file:";
/* Путь до файла с паком  */ const PackFile = "https://raw.githubusercontent.com/Woowz11/BloodRaw-Minecraft/refs/heads/main/BloodRaw-Pack.zip";

/* ======================================================== */

var Console = $("#Console");

Logger.Console = function(Message){
	Logger.Info(Message);
	Console.append(`<p>${Message}</p>`);
}

/* ======================================================== */

/* Информация об паке */
var Pack;

/* Генерация пака */
async function Generate(){
	try{
		if(!PreLoaded){ throw new Error("Пак ещё не был пред-загружен!"); }
		Console.empty();
		
		Logger.Console("Начало генерации пака!");
		
		Logger.Console(SelectedVersion);
		
		Logger.Console("Конец генерации пака!");
	}catch(e){
		Logger.Fatal("Произошла ошибка при генерации пака!", e);
	}
}

/* ======================================================== */

/* Файлы пака (Все файлы) */
const PackFiles = {};
/* Папки пака (Файлы внутри папок) */
const PackFolders = {};

/* Доступные версии пака */
const PackVersions = {}

/* Выбранная версия */
var SelectedVersion = null;

/* Получает разную информацию из пака */
function LoadPackInformation(){
	try{
		for(const Path of Object.keys(PackFiles)){
			const LastSlash = Path.lastIndexOf("/");
			const Folder    = LastSlash === -1 ? ""   : Path.substring(0,  LastSlash);
			
			if(!PackFolders[Folder]){ PackFolders[Folder] = []; }
			PackFolders[Folder].push(PackFiles[Path]);
		}
		
		for(const File of PackFolders["Generators"]){
			var Version = File.name.split("/").pop();
			const LastDot = Version.lastIndexOf(".");
			if(LastDot !== -1){ Version = Version.substring(0, LastDot); }
			PackVersions[Version] = true;
		}
	}catch(e){
		throw new Error("Произошла ошибка при загрузке информации об паке!", e);
	}
}

/* Вызывается после пре-загрузки */
function PreLoadAfter(){
	if(!StartPreLoaded){ return; }
	try{
		LoadPackInformation();
	
		const SelectVersion = $("#SelectVersion");
		Logger.Info(PackVersions);
		
		SelectVersion.html(Object.keys(PackVersions).map(V => `<option value="${V}">${V}</option>`).join(""));
		SelectVersion.select2({
			placeholder: "Выберите версию",
			allowClear: true
		});
		
		SelectedVersion = SelectVersion.val();
		
		SelectVersion.on('change', function(){ SelectedVersion = SelectVersion.val(); });
		
		PreLoaded = true;
	}catch(e){
		throw new Error("Произошла ошибка после пред-загрузки!", e);
	}
}

/* Начата пред-загрузка пака? */
var StartPreLoaded = false;
/* Пак пред-загружен? */
var PreLoaded = false;
/* Пре-загрузка пака (Только один раз!) */
async function PreLoad(Buf){
	if(StartPreLoaded || PreLoaded){ return; } StartPreLoaded = true;
	try{
		const ZIP = await JSZip.loadAsync(Buf);

		for (const Name of Object.keys(ZIP.files)) {
			const File = ZIP.files[Name];
			if(File.dir){ continue; }

			PackFiles[Name] = File;
		}
		
		PreLoadAfter();
	} catch(e){
		throw new Error("Произошла ошибка при пред-загрузке пака!", e);
	}
}

/* Вызывается при запуске сайта */
function Awake(){
	const PreLoadPack = $("#PreLoadPack");
	if (IsLocal){
		PreLoadPack.on("change", async (EV) => {
			try{
				const File = EV.target.files[0];
				if(!File){ return; }
				const Buf = await File.arrayBuffer();
				await PreLoad(Buf);
			}catch(e){
				Logger.Fatal("Произошла ошибка при получении пака с компьютера!", e);
			}
		});
		
		PreLoadPack.css("display", "unset");
	}else{
		(async () => {
			try{
				const response = await fetch(PackFile);
				if (!response.ok){ throw new __Error("Ошибка загрузки: " + response.status); }
				const Buf = await response.arrayBuffer();
				await PreLoad(Buf);
			}catch(e){
				Logger.Fatal("Произошла ошибка при получении пака с raw.githubusercontent.com!", e);
			}
		})();
	}
}
Awake();

/* Вызывается когда сайт загружен */
function SiteLoaded(){
	try{
	
	}catch(e){
		Logger.Fatal("Произошла ошибка при загрузке сайта!", e);
	}
}

$(document).ready(function(){ SiteLoaded(); });

</script>