<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>A,B → B,A</title>

<link rel="stylesheet" href="../Source/css.css">

<style>
html, button{
	font-size   : 1.25em;
	text-shadow : 0.135em 0.125em 0px color-mix(in srgb, currentColor 30%, black);
}

body { padding: 0 20px; }
textarea { width: 100%; height: 310px; }
</style>

</head>
<body>
<h2>A, B → B, A</h2>

<p>A, B</p>
<textarea id="input" autocomplete="off" spellcheck="false" placeholder='				"2" : {
					"2"  : ["Texture", "R/T/P/Splash_1.texture"]
				},
				"3" : {
					"1"  : ["Texture", "R/T/P/Bubble.png"]
				},
				"4" : {
					"1"  : ["Texture", "R/T/P/Fire.texture"],
					"2"  : ["Texture", "R/T/P/Lava.png"]
				}'></textarea>
<br>
<button onclick="convert()">Конвертировать</button>

<p style="margin-top: 30px;">B, A</p>
<button onclick="copyOutput()">Скопировать результат</button>
<textarea id="output" readonly placeholder='				"1" : {
					"3" : ["Texture", "R/T/P/Bubble.png"],
					"4" : ["Texture", "R/T/P/Fire.texture"]
				},
				"2" : {
					"2" : ["Texture", "R/T/P/Splash_1.texture"],
					"4" : ["Texture", "R/T/P/Lava.png"]
				}'></textarea>

<script>
function convert() {
    const input = document.getElementById("input").value;
    const lines = input.split('\n');

    const data = {};
    let currentY = null;
    let currentTabY = "";

    lines.forEach(line => {
        if (!line.trim() || line.trim() === '},' || line.trim() === '}') return;

        let matchY = line.match(/^(\s*)"(\d+)"\s*:/);
        if (matchY && line.trim().endsWith('{')) {
            currentY = matchY[2];
            currentTabY = matchY[1];
            data[currentY] = {tabY: currentTabY, values: {}};
            return;
        }

        let matchX = line.match(/^(\s*)"(\d+)"\s*:\s*(.+?),?\s*$/);
        if (matchX && currentY) {
            let tabX = matchX[1];
            let x = matchX[2];
            let value = matchX[3].trim();
            data[currentY].values[x] = {value: value, tabX: tabX};
        }
    });

    const result = {};
    const tabXRef = {};
    Object.keys(data).forEach(y => {
        const row = data[y];
        Object.keys(row.values).forEach(x => {
            if (!result[x]) result[x] = {values:{}, tabY: row.tabY};
            result[x].values[y] = {value: row.values[x].value, tabX: row.values[x].tabX};
            if (!tabXRef[x]) tabXRef[x] = row.tabY;
        });
    });

    let outputLines = [];
    const xKeys = Object.keys(result).sort((a,b)=>Number(a)-Number(b));
    xKeys.forEach(x => {
        let blockLines = [];
        blockLines.push(`${tabXRef[x]}"${x}" : {`);
        const yKeys = Object.keys(result[x].values).sort((a,b)=>Number(a)-Number(b));
        yKeys.forEach((y, yi) => {
            const item = result[x].values[y];
            blockLines.push(`${item.tabX}"${y}" : ${item.value}${yi < yKeys.length - 1 ? ',' : ''}`);
        });
        blockLines.push(`${tabXRef[x]}}`);
        outputLines.push(blockLines.join('\n'));
    });

    document.getElementById("output").value = outputLines.join(',\n');
}

function copyOutput() {
    const outputField = document.getElementById("output");
    outputField.select();
    outputField.setSelectionRange(0, 99999);
    document.execCommand("copy");
}
</script>
</body>
</html>
